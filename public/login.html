<html>
  <head>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>

  <body class="p-3 flex h-full justify-center items-start">
    <form class="relative p-3 flex justify-center flex-col m-auto border-solid border-2 border-gray-300 rounded" method="post">
      <h3 class="font-bold mb-3">Login</h3>
      <div class="mb-4">
        <label for="password" class="w-24 inline-block">Username:</label>
        <input name="username" type="username" class="border-solid border-2 border-gray-300 rounded bg-gray-100" required>
      </div>
      <div class="mb-4">
        <label for="password" class="w-24 inline-block">Password:</label>
        <input name="password" type="password" class="border-solid border-2 border-gray-300 rounded bg-gray-100" required>
      </div>
      <a class="underline text-blue-600 text-xs" href="http://localhost:3000/registration">Not signed up?</a>
      <button class="self-end rounded border-solid border-2 border-emerald-400 p-1 bg-emerald-400 font-medium" type="submit">sign in</button>

      <div class="absolute -bottom-14 left-1/2 -translate-x-1/2 bg-red-300 text-red-900 px-4 py-1 rounded">hello</div>

    </form>
  </body>
  <script>
        document
          .querySelector('form')
          .addEventListener('submit', event => {
            event.preventDefault();

            const { username, password } = event.target;
            const data = {
              username: username.value,
              plainPassword: password.value
            }

            fetch('http://localhost:3000/authentication/signin', {
              method: 'POST',
              headers: {
              'Content-Type': 'application/json',
            },
              body: JSON.stringify(data)
            })
              .then(response => {
                if(response.status === 401 ){
                  return response.json()
                  .then( err => {
                    const { error } = err
                    throw Error( error );
                  })
                }
                response.json()
              } )
              .then(data => {
                document.cookie = `token=${data}`
                window.location.href = 'http://localhost:3000'    
              }).catch((error) => {
                console.error(error)
              });
          });
  </script>
</html>
